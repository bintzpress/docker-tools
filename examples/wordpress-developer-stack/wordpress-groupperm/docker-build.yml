# This
#   1. pulls wordpress:5.8.2
#   2. pushes to private registry
#   3. builds wordpress-groupperm:5.8.2
#   4. pushes to private registry
#   5. pulls wordpress:beta-5.9-RC1
#   6. pushes to private registry
#   7. builds wordpress-groupperm:beta-5.9-RC1
#   8. pushes to private registry
#
version: "1.0"

images:
  wordpress-5-8-2:
    pull: wordpress:${WORDPRESS_LATEST}
    push:
      private-registry:

  wordpress-groupperm-5-8-2:
    depends_on: wordpress-5-8-2
    build:
      tag: wordpress-groupperm:${WORDPRESS_LATEST}
      context: ./context
      args:
        WORDPRESS_TAG: ${WORDPRESS_LATEST}
    push:
      private-registry:
        repository: ${OWNER}

  wordpress-beta-5-9-rc2:
    pull: wordpress:${WORDPRESS_BETA}
    push:
      private-registry:

  wordpress-groupperm-beta-5-9-rc2:
    depends_on: wordpress-beta-5-9-rc2
    build:
      tag: wordpress-groupperm:${WORDPRESS_BETA}
      context: ${CONTEXT}
      args: 
        WORDPRESS_TAG: ${WORDPRESS_BETA}
    push:
      private-registry:
        repository: ${OWNER}
  
registries:
  private-registry:
    url: ${REGISTRY_PRIVATE_URL}